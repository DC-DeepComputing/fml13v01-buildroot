From de29362501b331f640a3d1d1f18722b229044873 Mon Sep 17 00:00:00 2001
From: "zejian.su" <zejian.su@starfivetech.com>
Date: Wed, 15 Nov 2023 12:00:25 +0800
Subject: [PATCH] Fix the libcamera-still bug at low resolution (redmine
 #8306).

Set the raw stream's resolution too.

Signed-off-by: zejian.su <zejian.su@starfivetech.com>
---
 core/libcamera_app.cpp | 8 ++++++--
 1 file changed, 6 insertions(+), 2 deletions(-)

diff --git a/core/libcamera_app.cpp b/core/libcamera_app.cpp
index a49e31d..27d5c44 100644
--- a/core/libcamera_app.cpp
+++ b/core/libcamera_app.cpp
@@ -349,10 +349,14 @@ void LibcameraApp::ConfigureStill(unsigned int flags)
 		configuration_->at(0).bufferCount = 3;
 	else if (options_->buffer_count > 0)
 		configuration_->at(0).bufferCount = options_->buffer_count;
-	if (options_->width)
+	if (options_->width) {
 		configuration_->at(0).size.width = options_->width;
-	if (options_->height)
+		configuration_->at(1).size.width = options_->width;
+	}
+	if (options_->height) {
 		configuration_->at(0).size.height = options_->height;
+		configuration_->at(1).size.height = options_->height;
+	}
 	configuration_->at(0).colorSpace = libcamera::ColorSpace::Sycc;
 	configuration_->transform = options_->transform;
 
-- 
2.34.1

